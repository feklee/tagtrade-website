<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>TagTrade Wiki | PmWiki / WikiFarms browse</title>
  <meta http-equiv="Content-type" content="text/html;charset=iso-8859-1" />
  <meta http-equiv='Content-Style-Type' content='text/css' />
  <link rel='stylesheet' href='/pmwiki/pub/skins/tagtrade/tagtrade.css' type='text/css' />
  <!--HeaderText--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style>  <meta name='robots' content='noindex,nofollow' />

</head>
<body>
<!--PageHeaderFmt-->
  <div id='wikilogo'><a href=''><img src='/pmwiki/pub/skins/tagtrade/tagtrade-32.gif'
    alt='TagTrade Wiki' border='0' /></a></div>
  <div id='wikihead'>
  </div>
<!--/PageHeaderFmt-->
  <table id='wikimid' width='100%' cellspacing='0' cellpadding='0'><tr>
<!--PageLeftFmt-->
      <td id='wikileft' valign='top'>
        <p class='sidehead'> <a class='wikilink' href='/Main/HomePage'>Main</a>
</p><ul><li><a class='wikilink' href='/Main/Systems'>Systems</a>
</li><li><a class='wikilink' href='/Main/DiscussionGroups'>Discussion groups</a>
</li><li><a class='wikilink' href='/Main/Jabber'>Jabber group chat</a>
</li><li><a class='wikilink' href='/Main/Irc'>IRC channel</a>
</li><li><a class='wikilink' href='/Main/Events'>Events</a>
</li><li><a class='wikilink' href='/Main/TODO'>To do</a>
</li><li><a class='wikilink' href='/Main/WikiSandbox'>Wiki sandbox</a>
</li></ul><p class='vspace sidehead'> <a class='wikilink' href='/Devel/HomePage'>Devel</a>
</p><ul><li><a class='wikilink' href='/Devel/TODO'>To do</a>
</li><li><a class='wikilink' href='/Devel/BackEnd'>Back end</a>
</li><li><a class='wikilink' href='/Devel/FrontEnd'>Front end</a>
</li><li><a class='wikilink' href='/Devel/AuthoringPages'>Authoring pages</a>
</li></ul><p class='vspace sidehead'> <a class='wikilink' href='/Profiles/HomePage'>Profiles</a>
</p>
<p class='vspace sidehead'> <a class='wikilink' href='/PmWiki/PmWiki'>PmWiki</a>
</p>
<p class='vspace sidehead'> <a class='wikilink' href='/DocArchive/HomePage'>Doc archive</a>
</p>
<p class='vspace sidehead'> <a class='wikilink' href='/Portal/HomePage'>Portal</a>
</p><ul><li><a class='wikilink' href='/Portal/WikiSandbox'>Wiki sandbox</a>
</li></ul>
</td>
<!--/PageLeftFmt-->
      <td id='wikibody' valign='top'>
<!--PageTitleFmt-->
        <div id='wikititle'>
          <div class='pagegroup'><a href='/PmWiki'>PmWiki</a> /</div>
          <h1 class='pagetitle'>WikiFarms</h1></div>
<!--PageText-->
<div id='wikitext'>
<p>
<a name='trailstart' id='trailstart'></a> 
</p><div style="clear:right; float:right; font-size:smaller; background-color:#eee;" >
<p><span class='wikitrail'>&lt; <a class='wikilink' href='/PmWiki/WebFeeds'>Web feeds</a> | <a class='wikilink' href='/PmWiki/DocumentationIndex#trailstart#trailend'>Documentation Index</a> | <a class='wikilink' href='/PmWiki/FAQ'>Frequently answered questions</a> &gt;</span> 
</p></div>
<div style="clear:right;" ><span class='frame rfloat' style='font-size: smaller; background-color: #ffffcc;'>administrators (intermediate) </span>
</div>
<p>Also see: <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/Farm%20Setup%20By%20Example' rel='nofollow'>Cookbook:Farm Setup By Example</a>, <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/Wiki%20Farm%20Alternative' rel='nofollow'>Cookbook:Wiki Farm Alternative</a>
</p>
<p class='vspace'>A <a class='selflink' href='/PmWiki/WikiFarms'>WikiFarm</a> is a collection of two or more wikis running on the same web server and sharing a set of common components. The term is based on the computing phrase "server farm".
</p>
<p class='vspace'>This page provides some background information about WikiFarms and describes how to turn a "normal" configuration into a farm by adding a wiki.  There are many ways to configure wiki farms; this page describes only one, in an effort to make it as simple as possible for the administrator who is creating a farm for the first time.
</p>
<div class='vspace'></div><h2>Why use a farm?</h2>
<p>The primary motivation for using a wiki farm is to reduce the amount of administrative work involved in managing several wikis. In a farm, most of the PmWiki code is stored in one place and is shared by all the wikis. An administrator can (for example) upgrade to a new version of PmWiki on every wiki in the farm by simply updating the shared components in a single location.
</p>
<p class='vspace'>From a reader's point of view, each wiki in a farm is completely independent, and appears as a separate web site. Each wiki in a farm:
</p><ul><li>has its own URL, and the URLs can be in different domains
</li><li>can have its own look and feel by using different skins
</li><li>can have its own add-ons or "recipes" from the <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/CookbookBasics' rel='nofollow'>Cookbook</a>
</li><li>can have its own administrator responsible for local configuration
</li></ul><div class='vspace'></div><h2>Why not to use a farm</h2>
<p>Because the wikis in a farm are all independent, it is difficult (but not impossible) to provide services that require access to more than one wiki. For example, the PmWiki search function can only search within one wiki. Using a farm as a way of subdividing related content is generally a bad idea. A much better way to subdivide content is to use <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/WikiGroup' rel='nofollow'>WikiGroups</a>.
</p>
<div class='vspace'></div><h2>I still can't decide if I need a farm ...</h2>
<p>The good news is that you don't have to decide in advance. In fact, the recommended procedure is to first do a "normal" or single <a class='wikilink' href='/PmWiki/Installation'>installation</a> of PmWiki. Use it for a while. Create pages and edit them. Get to know how to add recipes. Be sure to try out <a class='wikilink' href='/PmWiki/WikiGroup'>WikiGroups</a> (they may be all you need).
</p>
<p class='vspace'>Once you have decided that you need another wiki, you have two basic choices:
</p><ol><li>Do a complete <a class='wikilink' href='/PmWiki/Installation'>installation</a> of PmWiki in a new directory. This gives you two totally independent wikis that are completely self-contained. This is <strong>not</strong> a wiki farm.
</li><li>Create a wiki farm using your existing wiki as the "home wiki" where most of the shared PmWiki components will live.
</li></ol><p class='vspace'>Choice number 1 can be a good choice for several reasons:
</p><ul><li>it is not a wiki farm, and requires no additional administrative knowledge - it's just two installations
</li><li>if you decide to move one of the wikis to another server, you can simply copy the wiki directory structure to the second server, and it will work (assuming there is a web server and PHP in place).
</li><li>you can run different versions of PmWiki on each wiki (good for testing new versions)
</li><li>no matter how badly you mess up one installation, it doesn't affect the other
</li></ul><p class='vspace'>If you choose to create a wiki farm, then read on ...
</p>
<div class='vspace'></div><h2>Prerequisites</h2>
<p>Before you create a farm, make sure that:
</p><ul><li>you have a working installation of PmWiki ready to become the home wiki for your farm
</li><li>all of the wikis in your farm will be on the same web server
</li><li>each wiki will have a unique URL, such as <a class='urllink' href='http://www.example.com/wiki1/' rel='nofollow'>http://www.example.com/wiki1/</a>, <a class='urllink' href='http://www.example.com/wiki2/' rel='nofollow'>http://www.example.com/wiki2/</a>, <a class='urllink' href='http://another.example.com/wiki1/' rel='nofollow'>http://another.example.com/wiki1/</a> and so on.
</li></ul><div class='vspace'></div><h2>Creating the home wiki</h2>
<p>You do have a working installation of PmWiki at this point, don't you? That's good, because your existing wiki is about to become the home wiki of your farm.
</p>
<p class='vspace'>In the directory that contains your existing wiki, create the file <em>local/farmconfig.php</em>. This file is used to hold any <a class='wikilink' href='/PmWiki/LocalCustomizations'>local customizations</a> that apply across the whole farm. For example, you could assign an admin password in <em>farmconfig.php</em> that will be used by all of the wikis in your farm.
</p>
<p class='vspace'>If the URL used to access your existing wiki is <a class='urllink' href='http://www.example.com/pmwiki/' rel='nofollow'>http://www.example.com/pmwiki/</a> then a minimal <em>farmconfig.php</em> file would look like this:
</p>
<div class='vspace'></div><div class='indent'><pre class='escaped'>&lt;?php if (!defined('PmWiki')) exit();
$FarmPubDirUrl = 'http://www.example.com/pmwiki/pub';</pre>
</div><p class='vspace'>This loads the variable <a class='varlink' href='/PmWiki/PathVariables#FarmPubDirUrl'><code class='varlink'>&#36;FarmPubDirUrl</code></a> with the URL location of your home wiki's <em>pub/</em> directory. All of the wikis in your farm share this <em>pub/</em> directory. The <em>pub/</em> directory holds skin definitions and GUI-edit buttons to be shared by all the wikis in the farm.
</p>
<p class='vspace'>Amazing as it may sound, this completes all of the changes you need to make in order to turn your existing wiki into the home wiki of your farm.
</p>
<div class='vspace'></div><h2>Creating an additional wiki in your farm</h2>
<div class='outdent'>1. Create a directory to hold the new wiki. This directory must be web-accessible, just like the directory that holds your home wiki.
<div class='vspace'></div></div><div class='outdent'>2. Create a file called <em>index.php</em> in the directory with the following contents:
<div class='vspace'></div><div class='indent'><code class='escaped'>    &lt;?php include('path/to/pmwiki.php'); </code>
</div></div><div class='vspace'></div><div class='indent'>This allows your new wiki to share the PmWiki code stored in your home wiki. The <em><code class='escaped'>path/to/pmwiki.php</code></em> is the file path to <em>pmwiki.php</em> in your home wiki. Use an absolute file path (<code class='escaped'>/home/username/pmwiki/pmwiki.php</code>) or a relative file path (<code class='escaped'>../pmwiki/pmwiki.php</code>). Do not use a url path - there should not be an '<code class='escaped'>http://</code>' in it anywhere. For a web server running under Windows, you need to use a complete file path as in <code class='escaped'>C:/Apache Group/Apache2 /www/mynewwiki/</code>.
</div><div class='vspace'></div><div class='outdent'>3. Open a web browser and browse the URL of the new wiki.  This will be a web address starting with '<code class='escaped'>http://</code>'.  PmWiki will attempt to automatically create a writable <em>wiki.d/</em> directory where the wiki's pages will be stored.  If you see an error message, follow the instructions.  If you choose the option for a "slightly more secure installation" be sure to execute both commands.
</div><p class='vspace'>Your new wiki is now set up, and your farm now contains 2 wikis. To add more wikis, just repeat these 3 steps.
</p>
<div class='vspace'></div><h2>Customization</h2>
<p>Each wiki in a farm inherits the settings stored in <em>farmconfig.php</em>. Do any customization that you want to apply farm-wide (to all the wikis) in <em>farmconfig.php</em>.
</p>
<p class='vspace'>Create a <em>local/</em> directory within each wiki's directory to hold <a class='wikilink' href='/PmWiki/LocalCustomizations'>local customizations</a> that apply only to that wiki. You should at least create the local/config.php file with a new title, like so : 
</p>
<div class='vspace'></div><div class='indent'><pre class='escaped'>
&lt;?php if (!defined('PmWiki')) exit();
  ## Title of your farmed wiki
  $WikiTitle = 'New Wiki';
?&gt;
</pre>
</div><p class='vspace'>Farm-wide customizations are processed before the individual wiki local customizations.
</p>
<p class='vspace'>The PmWiki variable <em><a class='varlink' href='/PmWiki/PathVariables#FarmD'><code class='varlink'>&#36;FarmD</code></a></em> points to the directory in which pmwiki.php is installed, and your home wiki, and it is used as a prefix to allow the other wikis to share PmWiki components. For example:
</p><ul><li><em><a class='varlink' href='/PmWiki/PathVariables#FarmD'><code class='varlink'>&#36;FarmD</code></a>/scripts/</em> points to the shared <em>scripts/</em> directory
</li><li><em><a class='varlink' href='/PmWiki/PathVariables#FarmD'><code class='varlink'>&#36;FarmD</code></a>/pub/</em> points to the shared <em>pub/</em> directory
</li><li><em><a class='varlink' href='/PmWiki/PathVariables#FarmD'><code class='varlink'>&#36;FarmD</code></a>/cookbook/</em> points to the shared <em>cookbook/</em> directory
</li></ul><p class='vspace'>Any <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/.' rel='nofollow'>Cookbook</a> scripts you include in farmconfig.php must be included with a line such as:
</p><div class='indent'><code>include_once("<a class='varlink' href='/PmWiki/PathVariables#FarmD'><code class='varlink'>&#36;FarmD</code></a>/cookbook/scriptfile.php");</code><br />Note the double quotes - single quotes may work for per farm inclusions, but they will not work for <a class='varlink' href='/PmWiki/PathVariables#FarmD'><code class='varlink'>&#36;FarmD</code></a>.
</div><div class='vspace'></div><h2>Notes</h2>
<ul><li>The terminology used to describe wiki farms is not used consistently. See <a class='wikilink' href='/PmWiki/WikiFarmTerminology'>WikiFarmTerminology</a> for more info.
</li><li>It is important to remember that not all of the recipes in the Cookbook have been written for or tested with farms. Be sure to look for instructions on how to use a recipe on a farm.
</li><li>There are many, many more things you can do with farms. Some are described on <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/WikiFarmsAdvanced' rel='nofollow'>PmWiki:WikiFarmsAdvanced</a> which also contains links to step-by-step examples of setting up a farm.
</li></ul><div class='vspace'></div><h2>Password use/authorization on farm wikis:</h2>
<p><strong> How come when I switch to another wiki within a farm, I keep my same authorization?</strong>
</p>
<p class='vspace'>PmWiki uses PHP sessions to keep track of authentication/authorization information, and by default PHP sets things up such that all interactions with the same server are considered part of the same session.
</p>
<p class='vspace'>An easy way to fix this is to make sure each wiki is using a different cookie name for its session identifier.  Near the top of one of the wiki's local/config.php files, before calling authuser or any other recipes, add a line like:
</p>
<div class='vspace'></div><div class='indent'><code>    session_name('XYZSESSID'); </code>
</div><p class='vspace'>You can pick any alphanumeric name for XYZSESSID; for example, for the cs559-1 wiki you might choose
</p>
<div class='vspace'></div><div class='indent'><code>    session_name('CS559SESSID'); </code>
</div><p class='vspace'>This will keep the two wikis' sessions independent of each other.
</p>
<p class='vspace'>Categories: <a class='urllink' href='http://www.pmwiki.org/wiki/CategoryWikiFarms' rel='nofollow'>WikiFarms</a>
</p>
<p class='vspace'> 
</p><div style="clear:right; float:right; font-size:smaller; background-color:#eee;" >
<p><span class='wikitrail'>&lt; <a class='wikilink' href='/PmWiki/WebFeeds'>Web feeds</a> | <a class='wikilink' href='/PmWiki/DocumentationIndex#trailstart#trailend'>Documentation Index</a> | <a class='wikilink' href='/PmWiki/FAQ'>Frequently answered questions</a> &gt;</span> 
</p></div>
<p><a name='trailend' id='trailend'></a>
<br clear='all' />
</p><div  style='background-color: #ffe; border-top: 1px solid black; font-size: .8em;' > 
<p>This page may have <span class='commentout-pmwikiorg'> a more recent version on <a class='urllink' href='http://www.pmwiki.org' rel='nofollow'>pmwiki.org</a>: <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/WikiFarms' rel='nofollow'>PmWiki:WikiFarms</a>, and </span> a talk page: <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/WikiFarms-Talk' rel='nofollow'>PmWiki:WikiFarms-Talk</a>.
</p></div>
</div>

      </td>
    </tr></table>
<!--PageFooterFmt-->
  <div id='wikifoot'>
    <div class='footinfo'></div>
  </div>
<!--/PageFooterFmt-->
</body>
</html>
