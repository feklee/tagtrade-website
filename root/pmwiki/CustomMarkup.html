<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>TagTrade Wiki | PmWiki / CustomMarkup browse</title>
  <meta http-equiv="Content-type" content="text/html;charset=iso-8859-1" />
  <meta http-equiv='Content-Style-Type' content='text/css' />
  <link rel='stylesheet' href='/pmwiki/pub/skins/tagtrade/tagtrade.css' type='text/css' />
  <!--HeaderText--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style>  <meta name='robots' content='noindex,nofollow' />

</head>
<body>
<!--PageHeaderFmt-->
  <div id='wikilogo'><a href=''><img src='/pmwiki/pub/skins/tagtrade/tagtrade-32.gif'
    alt='TagTrade Wiki' border='0' /></a></div>
  <div id='wikihead'>
  </div>
<!--/PageHeaderFmt-->
  <table id='wikimid' width='100%' cellspacing='0' cellpadding='0'><tr>
<!--PageLeftFmt-->
      <td id='wikileft' valign='top'>
        <p class='sidehead'> <a class='wikilink' href='/Main/HomePage'>Main</a>
</p><ul><li><a class='wikilink' href='/Main/Systems'>Systems</a>
</li><li><a class='wikilink' href='/Main/DiscussionGroups'>Discussion groups</a>
</li><li><a class='wikilink' href='/Main/Jabber'>Jabber group chat</a>
</li><li><a class='wikilink' href='/Main/Irc'>IRC channel</a>
</li><li><a class='wikilink' href='/Main/Events'>Events</a>
</li><li><a class='wikilink' href='/Main/TODO'>To do</a>
</li><li><a class='wikilink' href='/Main/WikiSandbox'>Wiki sandbox</a>
</li></ul><p class='vspace sidehead'> <a class='wikilink' href='/Devel/HomePage'>Devel</a>
</p><ul><li><a class='wikilink' href='/Devel/TODO'>To do</a>
</li><li><a class='wikilink' href='/Devel/BackEnd'>Back end</a>
</li><li><a class='wikilink' href='/Devel/FrontEnd'>Front end</a>
</li><li><a class='wikilink' href='/Devel/AuthoringPages'>Authoring pages</a>
</li></ul><p class='vspace sidehead'> <a class='wikilink' href='/Profiles/HomePage'>Profiles</a>
</p>
<p class='vspace sidehead'> <a class='wikilink' href='/PmWiki/PmWiki'>PmWiki</a>
</p>
<p class='vspace sidehead'> <a class='wikilink' href='/DocArchive/HomePage'>Doc archive</a>
</p>
<p class='vspace sidehead'> <a class='wikilink' href='/Portal/HomePage'>Portal</a>
</p><ul><li><a class='wikilink' href='/Portal/WikiSandbox'>Wiki sandbox</a>
</li></ul>
</td>
<!--/PageLeftFmt-->
      <td id='wikibody' valign='top'>
<!--PageTitleFmt-->
        <div id='wikititle'>
          <div class='pagegroup'><a href='/PmWiki'>PmWiki</a> /</div>
          <h1 class='pagetitle'>CustomMarkup</h1></div>
<!--PageText-->
<div id='wikitext'>
<p>
<a name='trailstart' id='trailstart'></a> 
</p><div style="clear:right; float:right; font-size:smaller; background-color:#eee;" >
<p><span class='wikitrail'>&lt; <a class='wikilink' href='/PmWiki/CustomInterMap'>Custom inter map</a> | <a class='wikilink' href='/PmWiki/DocumentationIndex#trailstart#trailend'>Documentation Index</a> | <a class='wikilink' href='/PmWiki/CustomWikiStyles'>Custom wiki styles</a> &gt;</span> 
</p></div>
<div style="clear:right;" ><span class='frame rfloat' style='font-size: smaller; background-color: #ffffcc;'>administrators (intermediate) </span>
</div>
<h2>Introduction</h2>
<p>PmWiki's markup translation engine is handled by a set of rules; each rule searches for a specific pattern in the markup text and replaces it with some replacement text.  Internally, this is accomplished by using PHP's "<a class='urllink' href='http://www.php.net/preg_replace' rel='nofollow'>preg_replace</a>" function.
</p>
<p class='vspace'>Rules are added to the translation engine via PmWiki's Markup() function, which looks like
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>Markup($name, $when, $pattern, $replace);</code>
</div><p class='vspace'>where <code class='escaped'>$name</code> is a unique name (a string) given to the rule, <code class='escaped'>$when</code> says when the rule should be applied relative to other rules, <code class='escaped'>$pattern</code> is the pattern to be searched for in the markup text, and <code class='escaped'>$replace</code> is what the pattern should be replaced with.
</p>
<p class='vspace'>For example, here's the code that creates the rule for <code class='escaped'>''emphasized text''</code> (in <em>scripts/stdmarkup.php</em>):
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>Markup("em", "inline", "/''(.*?)''/", "&lt;em&gt;$1&lt;/em&gt;");</code>
</div><p class='vspace'>Basically this statement says to create a rule called "em" to be performed with the other "inline" markups, and the rule replaces any text inside two pairs of single quotes with the same text ($1) surrounded by <code class='escaped'>&lt;em&gt;</code> and <code class='escaped'>&lt;/em&gt;</code>.
</p>
<p class='vspace'>The first two parameters to Markup() are used to specify the sequence in which rules should be applied.  The first parameter provides a name for a rule -- "<code class='escaped'>em</code>" in the example above.  We could've chosen other names such as "<code class='escaped'>''</code>", or even "<code class='escaped'>twosinglequotes</code>".  In general PmWiki uses the markup itself to name the rule (i.e., PmWiki uses "<code class='escaped'>''</code>" instead of "<code class='escaped'>em</code>"), but to keep this example easier to read later on we'll use a mnemonic name for now.
</p>
<p class='vspace'>The second parameter says that this rule is to be done along with the other "inline" markups.  PmWiki divides the translation process into a number of phases:
</p>
<div class='vspace'></div><pre class='escaped'>
_begin      start of translation
fulltext    translations to be performed on the full text            
split       conversion of the full markup text into lines to be processed
directives  directive processing
inline      inline markups
links       conversion of [[links]], url-links, and WikiWords     
block       block markups
style       style handling       
_end        end of translation
</pre>
<p class='vspace'>This argument is normally specified as a left-angle bracket ("before") or a right-angle bracket ("after") followed by the name of another rule. 
</p>
<p class='vspace'>Thus, specifying "inline" for the second parameter says that this rule should be applied when the other "inline" rules are being performed.  If we want a rule to be performed with the directives -- i.e., before inline rules are processed, we would specify "directives" or "&lt;inline" for the second parameter.
</p>
<div class='vspace'></div><div class='indent'><small>  A significant rule in terms of ordering is "{$var}" which substitutes variables -- if you say "&lt;{$var}" then your markup will be processed before variables are substituted whereas if you say "&gt;{$var}" then your markup will be processed after variables are substituted. </small>
</div><p class='vspace'>The third parameter is a Perl-compatible regular expression. Basically, it is a slash, a <a class='urllink' href='http://www.php.net/manual/en/reference.pcre.pattern.syntax.php' rel='nofollow'>regular expression</a>, another slash, and a set of optional <a class='urllink' href='http://www.php.net/manual/en/reference.pcre.pattern.modifiers.php' rel='nofollow'>modifiers</a>.
</p>
<p class='vspace'>The example uses the pattern string <code class='escaped'>"/''(.*?)''/"</code>, which uses <code class='escaped'>''(.*?)''</code> as the regular expression and no options. (The regular expression says "find two single quotes in succession, then as few arbitrary characters as are needed to make the match find something, then two additional single quotes in succession"; the parentheses "capture" a part of the wikitext for later use.)
</p>
<p class='vspace'>The fourth parameter is the replacement text that should be inserted instead of the marked-up wikitext. You can use <code class='escaped'>$1</code>, <code class='escaped'>$2</code>, etc. to insert the text from the first, second etc. parenthesised part of the regular expression.
</p>
<p class='vspace'>In the example, we have <code class='escaped'>"&lt;em&gt;$1&lt;/em&gt;"</code>, which is an <code class='escaped'>&lt;em&gt;</code>, the text matched by the first parentheses (i.e. by the <code class='escaped'>.*?</code> section of the pattern), and <code class='escaped'>&lt;/em&gt;</code>.
</p>
<p class='vspace'>Here's a rule for <code class='escaped'>@@monospaced@@</code> text:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>Markup("@@", "inline", "/@@(.*?)@@/", "&lt;code&gt;$1&lt;/code&gt;");</code>
</div><p class='vspace'>and for a <code class='escaped'>[:comment ...:]</code> directive that is simply removed from the output:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>Markup("comment", "directives", "/\\[:comment .*?:\\]/", '');</code>
</div><p class='vspace'>Okay, now how about the rule for <code class='escaped'>'''strong emphasis'''</code>?  We have to be a bit careful here, because although this translation should be performed along with other inline markup, we also have to make sure that the rule for <code class='escaped'>'''</code> is handled <em>before</em> the rule for <code class='escaped'>''</code>, because <code class='escaped'>'''</code> also contains <code class='escaped'>''</code>. The second parameter to Markup() can be used to specify the new rule's relationship to any other rule:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>Markup("strong", "&lt;em", "/'''(.*?)'''/", "&lt;strong&gt;$1&lt;/strong&gt;");</code>
</div><p class='vspace'>This creates a rule called "strong", and the second parameter "&lt;em" says to be sure that this rule is processed before the "em" rule we defined above.  If we wanted to do something after the "em" rule, we would use "&gt;em" instead.  Thus, it's possible to add rules at any point in PmWiki's markup translation process in an extensible manner.  (In fact, the "inline", "block", "directives", etc., phases above are just placeholder rules used to provide an overall sequence for other rules.  Thus one can use "&lt;inline" to specify rules that should be handled before any other inline rules.)             
</p>
<p class='vspace'>If you want to disable available markup just call e.g.:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>DisableMarkup("strong")</code>
</div><p class='vspace'>PmWiki's default markup rules are defined in the <em>scripts/stdmarkup.php</em> file.  To see the entire translation table as the program is running, the scripts/diag.php module adds "<code class='escaped'>?action=ruleset</code>", which displays the set of defined markup rules in the sequence in which they will be processed.  You can see it at <a class='wikilink' href='/PmWiki/CustomMarkup?action=ruleset'>CustomMarkup?action=ruleset</a>. You must first enable the action by setting <a class='varlink' href='/PmWiki/DebugVariables#EnableDiag'><code class='varlink'>&#36;EnableDiag</code></a> = 1 in your configuration file.
</p>
<div class='vspace'></div><h2>Other common examples</h2>
<h3>Define a custom markup to produce a specific HTML or Javascript sequence</h3>
<p>Suppose an admin wants to have a simple "<code class='escaped'>(:example:)</code>" markup that will always produce a fixed HTML string in the output, such as for a webring, Google AdSense display, or Javascript.  The Markup() call to do this would be:
</p>
<div class='vspace'></div><div class='indent'><pre class='escaped'>
Markup('example', 'directives',
  '/\\(:example:\\)/',
  Keep("&lt;div class='example'&gt;&lt;p&gt;Here is a 
    &lt;a target='_blank' href='http://www.example.com'&gt;link&lt;/a&gt; to
    &lt;em&gt;example.com&lt;/em&gt;&lt;/p&gt;&lt;/div&gt;") );
</pre>
</div><div class='vspace'></div><ul><li>The first argument is a unique name for the markup ("example").
</li><li>The second argument says to perform this markup along with other directives.
</li><li>The third argument is the pattern to look for "(:example:)".
</li><li>The fourth argument is the HTML that "(:example:)" is to be replaced with.  We use the Keep() function here to prevent the output from being further processed by PmWiki's markup rule -- in the above example, we don't want the <a class='urllink' href='http://www.example.com' rel='nofollow'>http://www.example.com</a> url to be again converted to a link.
</li></ul><p class='vspace'><a name='random' id='random'></a>
</p><h3>Define a markup to call a custom function that returns content</h3>
<p>An 'e' option on the <code class='escaped'>$pattern</code> parameter will cause the <code class='escaped'>$replace</code> parameter to be treated as a PHP expression to be evaluated instead of replacement text.  Thus, a markup to produce a random number between 1 and 100 might look like:
</p>
<div class='vspace'></div><div class='indent'><pre class='escaped'>
Markup('random', 'directives',
  '/\\(:random:\\)/e',
  "rand(1, 100)");
</pre>
</div><p class='vspace'>This calls the PHP built-in rand() function and substitutes the directive with the result.  Any function can be called, including functions defined in a <a class='wikilink' href='/PmWiki/LocalCustomizations'>local customization</a> file.
</p>
<p class='vspace'>Arguments can also be passed by using regular expression capturing parentheses, thus
</p>
<div class='vspace'></div><div class='indent'><pre class='escaped'>
Markup('randomargs', 'directives',
  '/\\(:random (\\d+) (\\d+):\\)/e',
  "rand('$1', '$2')");
</pre>
</div><p class='vspace'>will cause the markup <code class='escaped'>(:random 50 100:)</code> to generate a random number between 50 and 100.
</p>
<div class='vspace'></div><div class='indent'><span  style='font-style: italic; color: green;'> Note:  Be very careful with the /e modifier in regular expressions; malicious authors may be able to pass strings that cause arbitrary and undesirable PHP functions to be executed.</span>
</div><p class='vspace'>For a PmWiki function to help with parsing arbitrary sequences of arguments and key=value pairs, see <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/ParseArgs' rel='nofollow'>Cookbook:ParseArgs</a>.
</p>
<div class='vspace'></div><div class='faq' > <a name='faq' id='faq'></a> 
<p class='question'> How can I embed JavaScript into a page's output?</p>
<p> There are several ways to do this.  The <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/JavaScript' rel='nofollow'>Cookbook:JavaScript</a> recipe describes a simple means for embedding static JavaScript into web pages using <a class='selflink' href='/PmWiki/CustomMarkup'>custom markup</a>.  For editing JavaScript directly in wiki pages (which can pose various security risks), see the <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/JavaScript-Editable' rel='nofollow'>JavaScript-Editable</a> recipe.  For JavaScript that is to appear in headers or footers of pages, the <a class='wikilink' href='/PmWiki/Skins'>skin</a> template can be modified directly, or &lt;script&gt; statements can be inserted using the <a class='varlink' href='/PmWiki/LayoutVariables#HTMLHeaderFmt'><code class='varlink'>&#36;HTMLHeaderFmt</code></a> array.
</p>
<p class='vspace question'> How would I create a markup (<em>(:nodiscussion:)</em>) that will set a page variable (<em>{$HideDiscussion}</em>) which can be used by <em>(:if enabled HideDiscussion:)</em> in .PageActions?</p>
<p> Add the following section of code to your config.php
</p><div class='indent'><pre class='escaped'>
SDV($HideDiscussion, 0); 	#define var name
Markup('hideDiscussion', '&lt;{$var}',
 '/\\(:nodiscussion:\\)/e', 'setHideDiscussion(true)'); 
function setHideDiscussion($val) { 
  global $HideDiscussion; 
  $HideDiscussion = $val;
} 
</pre>
</div><p class='vspace'>This will enable the <code>(:if enabled HideDiscussion:)</code> markup to be used.  If you want to print the current value of {$HideDiscussion} (for testing purposes) on the page, you'll also need to add the line:  <br /><code>$FmtPV['$HideDiscussion'] = '$GLOBALS["HideDiscussion"]';</code>
</p>
<p class='vspace question'> PmWiki only supports tool tips for external links, can I use custom markup to add tool tips to internal links?</p>
<p> Yes, add the following custom markup to your config.php: <br /> Markup('%title%', 'inline', '/%title%(.*?)"(.*?)"(.*?)%%/', '&lt;span title="$2"&gt;$1$3&lt;/span&gt;');    # Add tool tips to internal links, Example: %title%[[link"tool tip"]]%% 
</p>
<p class='vspace'>Use the markup with internal links such as: <br /> %title%[[CookBook "cool" | Example]]%% 
</p>
<p class='vspace'> See also <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/LinkTitles' rel='nofollow'>Cookbook:LinkTitles</a>.
</p>
<p class='vspace question'> It appears that (.*?) does not match newlines in these functions, making the above example inoperable if the text to be wrappen in &lt;em&gt; contains new lines.</p>
<p> If you include the "s" modifier on the regular expression then the dot (.) will match newlines.  Thus your regular expression will be "/STUFF(.*?)/s".  That s at the very end is what you are looking for.  If you start getting into multi-line regexes you may be forced to look at the m option as well - let's anchors (^ and $) match not begin/end of strings but also begin/end of lines (i.e., right before/after a newline).
</p>
<p class='vspace question'> How do I get started writing recipes and creating my own custom markup?</p>
<p> <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/CustomMarkupAlt' rel='nofollow'>(alternate) Introduction to custom markup for Beginners</a>
 
</p></div><div style="clear:right; float:right; font-size:smaller; background-color:#eee;" >
<p><span class='wikitrail'>&lt; <a class='wikilink' href='/PmWiki/CustomInterMap'>Custom inter map</a> | <a class='wikilink' href='/PmWiki/DocumentationIndex#trailstart#trailend'>Documentation Index</a> | <a class='wikilink' href='/PmWiki/CustomWikiStyles'>Custom wiki styles</a> &gt;</span> 
</p></div>
<p><a name='trailend' id='trailend'></a>
<br clear='all' />
</p><div  style='background-color: #ffe; border-top: 1px solid black; font-size: .8em;' > 
<p>This page may have <span class='commentout-pmwikiorg'> a more recent version on <a class='urllink' href='http://www.pmwiki.org' rel='nofollow'>pmwiki.org</a>: <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/CustomMarkup' rel='nofollow'>PmWiki:CustomMarkup</a>, and </span> a talk page: <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/CustomMarkup-Talk' rel='nofollow'>PmWiki:CustomMarkup-Talk</a>.
</p></div>
</div>

      </td>
    </tr></table>
<!--PageFooterFmt-->
  <div id='wikifoot'>
    <div class='footinfo'></div>
  </div>
<!--/PageFooterFmt-->
</body>
</html>
